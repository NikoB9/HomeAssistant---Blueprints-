blueprint:
  name: Synchronize multiple Switches/Lights
  description: >
    ## Bind multiple switches or lights together to act in unison
    ğŸ”¥**Version**: v4.0
  domain: automation
  input:
    entities:
      name: Entities to synchronize
      description: Select two or more switches or lights to act together.
      selector:
        entity:
          multiple: true

trigger:
  - platform: state
    entity_id: !input entities

mode: single

condition:
  '{{ trigger.to_state.state != trigger.from_state.state }}'

action:
  - variables:
      changed_state: '{{ trigger.to_state.state }}'
  - repeat:
      for_each: !input entities
      sequence:
        - choose:
            - conditions:
                - '{{ repeat.item != trigger.entity_id }}'
                - '{{ states(repeat.item) != changed_state }}'
              sequence:
                - service_template: >
                    {% if changed_state == "on" %}
                      homeassistant.turn_on
                    {% else %}
                      homeassistant.turn_off
                    {% endif %}
                  entity_id: "{{ repeat.item }}"                    {% if changed_state == "on" %}
                      homeassistant.turn_on
                    {% else %}
                      homeassistant.turn_off
                    {% endif %}
                  entity_id: "{{ repeat.item }}"
